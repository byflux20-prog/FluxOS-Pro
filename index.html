<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>FluxOS Pro</title>
    
    <style>
        /* ========================================
           1. CORE STYLES
           ========================================
        */
        :root {
            --bg-gradient: linear-gradient(180deg, #A7C7E7 0%, #C1E1FF 30%, #E6E6FA 60%, #8A2BE2 100%);
            --glass: rgba(255, 255, 255, 0.45);
            --border: rgba(255, 255, 255, 0.2);
            --text: #000;
            --radius: 18px;
            --blue: #007AFF;
            --safe-area-top: 50px;
        }

        * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; user-select:none; outline:none; }
        body { font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", sans-serif; background:#000; color:#fff; height:100vh; width:100vw; overflow:hidden; position:relative; }

        /* ========================================
           2. SETUP & LAYERS
           ========================================
        */
        #setupScreen {
            position:fixed; top:0; left:0; width:100%; height:100%; background:#f2f2f7; z-index:9999;
            display:flex; flex-direction:column; justify-content:center; align-items:center; padding:30px; color:#000; transition:opacity 0.5s;
        }
        .setup-t { font-size:28px; font-weight:700; margin-bottom:10px; text-align:center; }
        .setup-d { font-size:15px; color:#666; margin-bottom:30px; text-align:center; }
        .setup-in { width:100%; max-width:300px; padding:15px; border-radius:12px; border:1px solid #ccc; background:#fff; font-size:16px; margin-bottom:20px; text-align:center; }
        .setup-btn { background:var(--blue); color:#fff; padding:15px 50px; border-radius:25px; border:none; font-size:16px; font-weight:600; }

        #wallpaper { position:fixed; top:0; left:0; width:100%; height:100%; background:var(--bg-gradient); z-index:-10; }
        #statusBar {
            position:fixed; top:0; width:100%; height:48px; display:flex; justify-content:space-between; align-items:center;
            padding:0 24px; font-size:15px; font-weight:600; color:var(--text); z-index:2000; transition:color 0.3s;
        }
        #statusBar.light { color:#fff; text-shadow:0 1px 3px rgba(0,0,0,0.5); }

        /* ========================================
           3. ICONS (CSS ART)
           ========================================
        */
        .icon { width:64px; height:64px; border-radius:var(--radius); background:#fff; box-shadow:0 6px 15px rgba(0,0,0,0.12); position:relative; overflow:hidden; transform-origin:center; transition:transform 0.1s; }
        .wrap:active .icon { transform:scale(0.9); }

        /* JamKu */
        .ic-jam { background:#fff; display:flex; justify-content:center; align-items:center; }
        .cf { width:56px; height:56px; background:#eee; border-radius:50%; position:relative; }
        .c-dot { position:absolute; top:50%; left:50%; width:6px; height:6px; background:#000; border-radius:50%; transform:translate(-50%,-50%); z-index:10; }
        .hh { position:absolute; top:50%; left:50%; width:4px; height:14px; background:#000; transform-origin:bottom center; border-radius:2px; transform:translate(-50%,-100%) rotate(0deg); }
        .hm { position:absolute; top:50%; left:50%; width:3px; height:20px; background:#000; transform-origin:bottom center; border-radius:2px; transform:translate(-50%,-100%) rotate(0deg); }
        .hs { position:absolute; top:50%; left:50%; width:1px; height:24px; background:red; transform-origin:bottom center; transform:translate(-50%,-80%) rotate(0deg); z-index:5; }

        /* Lainnya */
        .ic-ram { background:linear-gradient(135deg, #1a472a, #2f5f43); display:flex; justify-content:center; align-items:center; }
        .moon { width:25px; height:25px; border-radius:50%; box-shadow:-6px 3px 0 0 #FFD700; transform:translate(4px,-2px) rotate(-10deg); }
        .ic-note { background:#FFD60A; display:flex; justify-content:center; align-items:center; }
        .note-p { width:40px; height:48px; background:#fff; border-radius:4px; position:relative; overflow:hidden; }
        .note-h { width:100%; height:12px; background:#FF9F0A; } .note-l { width:80%; height:2px; background:#eee; margin:6px auto 0; }
        .ic-draw { background:#fff; display:flex; justify-content:center; align-items:center; }
        .pen { width:12px; height:45px; background:var(--blue); transform:rotate(45deg); border-radius:6px; position:relative; }
        .tip { position:absolute; top:0; left:0; width:100%; height:12px; background:#5AC8FA; border-radius:6px 6px 0 0; }
        .ic-calc { background:#1C1C1E; display:flex; flex-direction:column; justify-content:center; align-items:center; gap:4px; }
        .cr { display:flex; gap:4px; } .cd { width:12px; height:12px; border-radius:50%; } .cg { background:#505050; } .co { background:#FF9F0A; }
        .ic-file { background:#fff; display:flex; justify-content:center; align-items:center; }
        .fb { width:40px; height:32px; background:#5AC8FA; border-radius:0 0 6px 6px; position:absolute; bottom:14px; }
        .ft { width:18px; height:8px; background:#5AC8FA; border-radius:4px 4px 0 0; position:absolute; top:14px; left:12px; }
        .fp { width:34px; height:28px; background:#fff; position:absolute; top:10px; left:15px; border-radius:2px; box-shadow:0 1px 3px rgba(0,0,0,0.2); }
        .ic-cal { background:#fff; display:flex; flex-direction:column; align-items:center; padding-top:11px; }
        .ch { color:#ff3b30; font-size:11px; font-weight:800; } .cn { color:#000; font-size:36px; font-weight:300; line-height:1; margin-top:2px; }
        .ic-set { background:#8E8E93; display:flex; justify-content:center; align-items:center; }
        .gr { width:50px; height:50px; fill:#fff; animation:sp 20s linear infinite; } @keyframes sp{to{transform:rotate(360deg);}}

        /* ========================================
           4. APP CONTAINER
           ========================================
        */
        #win {
            position:fixed; top:0; left:0; width:100%; height:100%; background:#fff; z-index:800; opacity:0; pointer-events:none;
            transition:transform 0.5s cubic-bezier(0.2,0.8,0.2,1), opacity 0.3s, border-radius 0.5s;
            overflow:hidden; display:flex; flex-direction:column; border-radius:var(--radius);
            padding-top: var(--safe-area-top);
        }
        #win.active { opacity:1; transform:none!important; border-radius:0; pointer-events:auto; }
        #win.dark-mode { background:#000; }

        /* ========================================
           5. INTERNAL VIEWS
           ========================================
        */
        /* MODAL */
        #modalName {
            position:absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:900;
            display:none; justify-content:center; align-items:center;
        }
        .modal-box { background:#fff; padding:20px; border-radius:20px; width:80%; text-align:center; }
        .modal-in { width:100%; padding:10px; margin:15px 0; border:1px solid #ddd; border-radius:8px; font-size:16px; }
        .modal-btn { padding:10px 20px; border-radius:15px; border:none; font-weight:600; margin:0 5px; }
        .btn-ok { background:var(--blue); color:#fff; } .btn-cancel { background:#eee; color:#000; }

        /* FILE PICKER */
        #filePicker { display:none; flex:1; flex-direction:column; background:#F2F2F7; }
        .fp-head { padding:10px 20px; display:flex; justify-content:space-between; align-items:center; background:#fff; border-bottom:1px solid #ddd; }
        .fp-title { font-size:24px; font-weight:800; color:#000; }
        .fp-add { font-size:30px; color:var(--blue); cursor:pointer; }
        .fp-list { padding:15px; overflow-y:auto; flex:1; }
        .fp-item { background:#fff; border-radius:12px; padding:15px; margin-bottom:10px; display:flex; align-items:center; box-shadow:0 2px 5px rgba(0,0,0,0.05); }
        .fp-icon { width:40px; height:40px; border-radius:8px; display:flex; justify-content:center; align-items:center; font-size:20px; margin-right:15px; color:#fff; }
        .bg-note { background:#FFD60A; } .bg-draw { background:var(--blue); }
        .fp-info { flex:1; } .fp-name { font-size:16px; font-weight:600; color:#000; } .fp-date { font-size:12px; color:#888; }
        .fp-del { color:#FF3B30; font-weight:600; font-size:14px; padding:5px; }

        /* NOTE EDITOR */
        #editorNote { display:none; flex:1; flex-direction:column; background:#fff9c4; }
        .ed-head { height:50px; display:flex; justify-content:space-between; align-items:center; padding:0 15px; border-bottom:1px solid rgba(0,0,0,0.1); }
        .ed-back { color:var(--blue); font-weight:600; font-size:16px; display:flex; align-items:center; }
        .ed-title { font-weight:700; color:#000; }
        .ed-save { color:var(--blue); font-weight:600; font-size:16px; }
        .ed-area { flex:1; padding:20px; font-size:18px; line-height:1.5; border:none; background:transparent; resize:none; color:#333; }

        /* DRAW EDITOR (7 WARNA + ERASER) */
        #editorDraw { display:none; flex:1; flex-direction:column; background:#fff; position:relative; }
        .dr-head { height:60px; background:#f9f9f9; display:flex; justify-content:space-between; align-items:center; padding:0 15px; border-bottom:1px solid #ddd; }
        .dr-tools { display:flex; gap:8px; align-items:center; overflow-x:auto; padding-right:10px; }
        .cp { width:22px; height:22px; border-radius:50%; border:2px solid #fff; box-shadow:0 2px 4px rgba(0,0,0,0.2); transition:transform 0.1s; flex-shrink:0; }
        .cp-erase { font-size:16px; display:flex; justify-content:center; align-items:center; background:#eee; border:2px solid #ccc; width:26px; height:26px; }
        .cp.active { transform:scale(1.2); border:2px solid #000; }
        canvas { flex:1; display:block; touch-action:none; width:100%; height:100%; cursor:crosshair; }

        /* CALCULATOR */
        #nativeCalc { display:none; width:100%; height:100%; background:#000; flex-direction:column; }
        .c-disp { flex:1; display:flex; align-items:flex-end; justify-content:flex-end; padding:20px 30px; width:100%; font-weight:200; color:#fff; line-height:1; font-size:80px; }
        .c-pad { display:grid; grid-template-columns:repeat(4,1fr); gap:15px; padding:20px; width:100%; max-width:500px; margin:0 auto 40px; }
        .cb { aspect-ratio:1; border-radius:50%; border:none; font-size:32px; font-weight:500; display:flex; justify-content:center; align-items:center; }
        .cb:active { filter:brightness(1.3); }
        .bg { background:#A5A5A5; color:#000; } .bd { background:#333; color:#fff; } .bo { background:#FF9F0A; color:#fff; }
        .cz { grid-column:span 2; aspect-ratio:auto; border-radius:40px; justify-content:flex-start; padding-left:35px; }

        /* IFRAME */
        iframe { width:100%; height:100%; border:none; flex:1; display:none; }

        /* ========================================
           6. SCREENS & BAR
           ========================================
        */
        #lock { position:fixed; top:0; width:100%; height:100%; background:var(--bg-gradient); z-index:500; display:flex; flex-direction:column; justify-content:space-between; align-items:center; padding:80px 0 40px; transition:transform 0.6s cubic-bezier(0.2,0.8,0.2,1); }
        #lock.open { transform:translateY(-100%); }
        .t-big { font-size:92px; font-weight:500; letter-spacing:-3px; line-height:1; color:#1c1c1e; }
        .d-med { font-size:22px; margin-top:10px; color:#1c1c1e; }
        .greet { margin-top:25px; font-size:16px; background:rgba(255,255,255,0.3); padding:8px 20px; border-radius:20px; color:#000; }

        #home { position:fixed; top:0; width:100%; height:100%; z-index:100; display:flex; flex-direction:column; align-items:center; padding-top:70px; }
        .grid { display:grid; grid-template-columns:repeat(4,1fr); gap:20px 15px; width:90%; margin-top:35px; }
        .wrap { display:flex; flex-direction:column; align-items:center; cursor:pointer; position:relative; z-index:1; }
        .name { margin-top:8px; font-size:11px; font-weight:500; color:#000; text-align:center; text-shadow:0 1px 4px rgba(255,255,255,0.6); }
        .dock { position:absolute; bottom:35px; width:90%; height:96px; background:rgba(255,255,255,0.45); backdrop-filter:blur(30px); border-radius:40px; display:flex; justify-content:space-around; align-items:center; border:1px solid rgba(255,255,255,0.2); }

        #bar { position:fixed; bottom:0; width:100%; height:40px; z-index:2500; display:flex; justify-content:center; align-items:flex-end; padding-bottom:10px; }
        .bl { width:130px; height:5px; background:#000; border-radius:10px; transition:0.3s; }
        #bar.w .bl { background:#fff; opacity:0.6; }

    </style>
</head>
<body>

    <div id="setupScreen">
        <div class="setup-t">FluxOS Pro</div>
        <div class="setup-d">Daftarkan namamu untuk pelanggan Paket FluxOS Pro</div>
        <input type="text" id="userInput" class="setup-in" placeholder="Nama Pelanggan" autocomplete="off">
        <button class="setup-btn" onclick="regUser()">Daftar Sekarang</button>
    </div>

    <div id="wallpaper"></div>
    <div id="statusBar"><span>FluxOS Pro</span><div style="display:flex; gap:8px;"><span>üì∂</span><span>üîã</span></div></div>

    <div id="lock">
        <div style="text-align:center;">
            <div class="t-big" id="lc">12:00</div>
            <div class="d-med" id="ld">Senin, 1 Jan</div>
            <div class="greet" id="lg">Selamat Datang</div>
        </div>
        <div style="text-align:center; opacity:0.7; animation:pulse 2s infinite;">Usap untuk membuka</div>
    </div>

    <div id="home">
        <div class="grid">
            <div class="wrap" onclick="launch('files', 'all', this)">
                <div class="icon ic-file"><div class="fp"></div><div class="ft"></div><div class="fb"></div></div>
                <div class="name">ByFile</div>
            </div>
            <div class="wrap" onclick="launch('files', 'note', this)">
                <div class="icon ic-note"><div class="note-p"><div class="note-h"></div><div class="note-l"></div><div class="note-l"></div></div></div>
                <div class="name">FluxNote</div>
            </div>
            <div class="wrap" onclick="launch('files', 'draw', this)">
                <div class="icon ic-draw"><div class="pen"><div class="tip"></div></div></div>
                <div class="name">FluxDraw</div>
            </div>
            <div class="wrap" onclick="launch('calc', '', this)">
                <div class="icon ic-calc"><div class="cr"><div class="cd cg"></div><div class="cd cg"></div></div><div class="cr"><div class="cd cg"></div><div class="cd co"></div></div></div>
                <div class="name">Kalkulator</div>
            </div>
            <div class="wrap" onclick="launch('web', 'https://byflux20-prog.github.io/RamadhanKu-2026-Nuriz/', this)">
                <div class="icon ic-ram"><div class="moon"></div></div>
                <div class="name">RamadhanKu</div>
            </div>
        </div>

        <div class="dock">
            <div class="wrap" onclick="launch('web', 'https://byflux20-prog.github.io/Jamdigital/', this)">
                <div class="icon ic-jam"><div class="cf"><div class="hh" id="ihh"></div><div class="hm" id="ihm"></div><div class="hs" id="ihs"></div><div class="c-dot"></div></div></div>
            </div>
            <div class="wrap" onclick="launch('web', 'https://www.tanggalan.com/', this)">
                <div class="icon ic-cal"><div class="ch" id="dM">FEB</div><div class="cn" id="dD">17</div></div>
            </div>
            <div class="wrap" onclick="launch('web', 'https://byflux20-prog.github.io/Setting/', this)">
                <div class="icon ic-set"><svg class="gr" viewBox="0 0 24 24"><path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18-0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/></svg></div>
            </div>
        </div>
    </div>

    <div id="win">
        <div id="modalName">
            <div class="modal-box">
                <h3>File Baru</h3>
                <input type="text" id="modalInput" class="modal-in" placeholder="Nama File">
                <div style="display:flex; justify-content:center;">
                    <button class="modal-btn btn-cancel" onclick="closeModal()">Batal</button>
                    <button class="modal-btn btn-ok" onclick="confirmNewFile()">Buat</button>
                </div>
            </div>
        </div>

        <div id="filePicker">
            <div class="fp-head"><span id="fpTitle">File Saya</span><span class="fp-add" onclick="showNewFileModal()">+</span></div>
            <div class="fp-list" id="fpList"></div>
        </div>

        <div id="editorNote">
            <div class="ed-head">
                <div class="ed-back" onclick="goBackToFileList()">‚ùÆ Files</div>
                <div class="ed-title" id="noteTitleDisplay">Catatan</div>
                <div class="ed-save" onclick="saveCurrentWork()">Simpan</div>
            </div>
            <textarea id="noteArea" class="ed-area" placeholder="Ketik disini..."></textarea>
        </div>

        <div id="editorDraw">
            <div class="dr-head">
                <div class="ed-back" onclick="goBackToFileList()">‚ùÆ Files</div>
                <div class="dr-tools">
                    <div class="cp" style="background:#000" onclick="setPenColor('#000', this)"></div>
                    <div class="cp" style="background:#FF3B30" onclick="setPenColor('#FF3B30', this)"></div>
                    <div class="cp" style="background:#007AFF" onclick="setPenColor('#007AFF', this)"></div>
                    <div class="cp" style="background:#34C759" onclick="setPenColor('#34C759', this)"></div>
                    <div class="cp" style="background:#FFCC00" onclick="setPenColor('#FFCC00', this)"></div>
                    <div class="cp" style="background:#AF52DE" onclick="setPenColor('#AF52DE', this)"></div>
                    <div class="cp" style="background:#A2845E" onclick="setPenColor('#A2845E', this)"></div>
                    <div class="cp cp-erase" onclick="setEraser(this)">üßΩ</div>
                </div>
                <div class="ed-save" onclick="saveCurrentWork()">Simpan</div>
            </div>
            <canvas id="canv"></canvas>
        </div>

        <div id="nativeCalc">
            <div id="cDisp" class="c-disp">0</div>
            <div class="c-pad">
                <button class="cb bg" onclick="clr()">AC</button><button class="cb bg" onclick="app('+/-')">+/-</button><button class="cb bg" onclick="app('%')">%</button><button class="cb bo" onclick="app('/')">√∑</button>
                <button class="cb bd" onclick="app('7')">7</button><button class="cb bd" onclick="app('8')">8</button><button class="cb bd" onclick="app('9')">9</button><button class="cb bo" onclick="app('*')">√ó</button>
                <button class="cb bd" onclick="app('4')">4</button><button class="cb bd" onclick="app('5')">5</button><button class="cb bd" onclick="app('6')">6</button><button class="cb bo" onclick="app('-')">-</button>
                <button class="cb bd" onclick="app('1')">1</button><button class="cb bd" onclick="app('2')">2</button><button class="cb bd" onclick="app('3')">3</button><button class="cb bo" onclick="app('+')">+</button>
                <button class="cb bd cz" onclick="app('0')">0</button><button class="cb bd" onclick="app('.')">,</button><button class="cb bo" onclick="cal()">=</button>
            </div>
        </div>

        <iframe id="web"></iframe>
    </div>

    <div id="bar"><div class="bl"></div></div>

    <script>
        // --- 1. USER & STORAGE ---
        const UID = 'flux_pro_user';
        if(localStorage.getItem(UID)){ document.getElementById('setupScreen').style.display='none'; document.getElementById('lg').innerText="Halo, "+localStorage.getItem(UID); }
        function regUser(){ const n=document.getElementById('userInput').value; if(n){ localStorage.setItem(UID,n); location.reload(); } }

        // --- 2. LIVE CLOCK ---
        function updateTime() {
            const d=new Date(); const h=d.getHours(), m=d.getMinutes(), s=d.getSeconds();
            const hDeg = (h%12)*30 + m*0.5; const mDeg = m*6; const sDeg = s*6;
            document.getElementById('ihh').style.transform = `translate(-50%,-100%) rotate(${hDeg}deg)`;
            document.getElementById('ihm').style.transform = `translate(-50%,-100%) rotate(${mDeg}deg)`;
            document.getElementById('ihs').style.transform = `translate(-50%,-80%) rotate(${sDeg}deg)`;
            
            const hStr=String(h).padStart(2,'0'), mStr=String(m).padStart(2,'0');
            document.getElementById('lc').innerText = hStr+':'+mStr;
            const mo=['JAN','FEB','MAR','APR','MEI','JUN','JUL','AGU','SEP','OKT','NOV','DES'];
            const days=['Ming','Sen','Sel','Rab','Kam','Jum','Sab'];
            document.getElementById('ld').innerText = days[d.getDay()]+', '+d.getDate()+' '+mo[d.getMonth()];
            document.getElementById('dM').innerText=mo[d.getMonth()]; document.getElementById('dD').innerText=d.getDate();
        }
        setInterval(updateTime, 1000); updateTime();

        // --- 3. FILES SYSTEM ---
        let FILES = JSON.parse(localStorage.getItem('flux_files_pro') || '[]');
        let currentAppType = ''; let currentFileId = null;
        function saveSystem() { localStorage.setItem('flux_files_pro', JSON.stringify(FILES)); }

        function showFileList(type) {
            currentAppType = type;
            document.getElementById('filePicker').style.display = 'flex';
            document.getElementById('fpTitle').innerText = type === 'all' ? 'Semua File' : (type === 'note' ? 'Catatan' : 'Galeri');
            const list = document.getElementById('fpList'); list.innerHTML = '';
            const filtered = type === 'all' ? FILES : FILES.filter(f => f.type === type);
            if(filtered.length === 0) list.innerHTML = '<div style="text-align:center; color:#999; margin-top:50px;">Belum ada file</div>';
            filtered.forEach(f => {
                const icon = f.type === 'note' ? 'üìù' : 'üé®'; const bg = f.type === 'note' ? 'bg-note' : 'bg-draw';
                list.innerHTML += `<div class="fp-item" onclick="openFile(${f.id})"><div class="fp-icon ${bg}">${icon}</div><div class="fp-info"><div class="fp-name">${f.name}</div><div class="fp-date">${f.date}</div></div><div class="fp-del" onclick="deleteFile(${f.id}, event)">Hapus</div></div>`;
            });
        }

        // --- 4. CRUD ---
        function showNewFileModal() { if(currentAppType==='all'){alert("Buka Note/Draw dulu.");return;} document.getElementById('modalName').style.display='flex'; document.getElementById('modalInput').value=''; document.getElementById('modalInput').focus(); }
        function closeModal() { document.getElementById('modalName').style.display='none'; }
        function confirmNewFile() {
            const name = document.getElementById('modalInput').value || 'Tanpa Judul';
            const id = Date.now();
            FILES.unshift({ id:id, type:currentAppType, name:name, date:new Date().toLocaleDateString(), data:'' });
            saveSystem(); closeModal(); openFile(id);
        }
        function deleteFile(id, e) { e.stopPropagation(); if(confirm('Hapus permanen?')) { FILES=FILES.filter(f=>f.id!==id); saveSystem(); showFileList(currentAppType); } }
        function openFile(id) {
            const f = FILES.find(x=>x.id===id); if(!f) return; currentFileId = id;
            document.getElementById('filePicker').style.display = 'none';
            if(f.type === 'note') {
                document.getElementById('editorNote').style.display='flex'; document.getElementById('noteTitleDisplay').innerText=f.name; document.getElementById('noteArea').value=f.data;
            } else {
                document.getElementById('editorDraw').style.display='flex'; initCanvas();
                if(f.data) { const img=new Image(); img.onload=()=>ctx.drawImage(img,0,0); img.src=f.data; }
            }
        }
        function saveCurrentWork() {
            const f = FILES.find(x=>x.id===currentFileId); if(!f) return;
            f.data = f.type==='note' ? document.getElementById('noteArea').value : canvas.toDataURL();
            saveSystem(); alert('Tersimpan!');
        }
        function goBackToFileList() { document.getElementById('editorNote').style.display='none'; document.getElementById('editorDraw').style.display='none'; showFileList(currentAppType); }

        // --- 5. DRAW ENGINE (LOCKED) ---
        const canvas = document.getElementById('canv'); const ctx = canvas.getContext('2d');
        let isPainting = false;

        function initCanvas() {
            // FIX KOORDINAT: Canvas Size harus sama persis dengan Display Size
            const rect = document.getElementById('editorDraw').getBoundingClientRect();
            canvas.width = rect.width; canvas.height = rect.height - 60;
            ctx.lineCap = 'round'; setPenColor('#000', document.querySelector('.cp')); 
        }

        function setPenColor(color, el) {
            ctx.globalCompositeOperation = 'source-over'; ctx.strokeStyle = color; ctx.lineWidth = 5;
            document.querySelectorAll('.cp').forEach(c=>c.classList.remove('active')); el.classList.add('active');
        }
        
        function setEraser(el) {
            ctx.globalCompositeOperation = 'destination-out'; ctx.lineWidth = 25; 
            document.querySelectorAll('.cp').forEach(c=>c.classList.remove('active')); el.classList.add('active');
        }

        function getPos(e) {
            const rect = canvas.getBoundingClientRect(); 
            const cx = e.touches ? e.touches[0].clientX : e.clientX;
            const cy = e.touches ? e.touches[0].clientY : e.clientY;
            return { x: cx - rect.left, y: cy - rect.top }; 
        }

        function drawStart(e) { isPainting=true; drawMove(e); }
        function drawEnd() { isPainting=false; ctx.beginPath(); }
        function drawMove(e) {
            if(!isPainting) return; e.preventDefault();
            const pos = getPos(e);
            ctx.lineTo(pos.x, pos.y); ctx.stroke(); ctx.beginPath(); ctx.moveTo(pos.x, pos.y);
        }
        canvas.addEventListener('touchstart', drawStart, {passive:false}); canvas.addEventListener('touchmove', drawMove, {passive:false}); canvas.addEventListener('touchend', drawEnd);
        canvas.addEventListener('mousedown', drawStart); canvas.addEventListener('mousemove', drawMove); canvas.addEventListener('mouseup', drawEnd);

        // --- 6. CALCULATOR & LAUNCHER ---
        let cv='0'; function app(v){ if(cv=='0' && !isNaN(v)) cv=v; else cv+=v; updC(); } function clr(){ cv='0'; updC(); } function cal(){ try{cv=String(eval(cv));}catch{cv='Error';} updC(); }
        function updC() { const d=document.getElementById('cDisp'); d.innerText=cv; if(cv.length>8) d.style.fontSize='50px'; else d.style.fontSize='80px'; }

        const win=document.getElementById('win'), bar=document.getElementById('bar'), status=document.getElementById('statusBar');
        let lastRect=null, isOpen=false;
        function launch(type, param, el) {
            if(isOpen) return; isOpen=true; const r=el.querySelector('.icon').getBoundingClientRect(); lastRect=r;
            const sx=r.width/window.innerWidth, sy=r.height/window.innerHeight, tx=(r.left+r.width/2)-(window.innerWidth/2), ty=(r.top+r.height/2)-(window.innerHeight/2);
            win.style.transition='none'; win.style.transform=`translate(${tx}px,${ty}px) scale(${sx},${sy})`; win.style.opacity='1'; win.style.borderRadius='16px';
            ['web','nativeCalc','filePicker','editorNote','editorDraw'].forEach(id=>document.getElementById(id).style.display='none');
            win.classList.remove('dark-mode'); bar.className=''; status.className='';
            if(type==='web'){ document.getElementById('web').style.display='block'; document.getElementById('web').src=param; }
            else if(type==='calc'){ document.getElementById('nativeCalc').style.display='flex'; win.classList.add('dark-mode'); bar.className='w'; status.className='light'; }
            else if(type==='files'){ showFileList(param); }
            win.offsetHeight; win.style.transition='transform 0.5s cubic-bezier(0.2,0.8,0.2,1), border-radius 0.5s'; win.classList.add('active');
        }

        let sY=0; bar.addEventListener('touchstart', e=>sY=e.touches[0].clientY);
        bar.addEventListener('touchmove', e=>{
            if(isOpen && sY-e.touches[0].clientY>40) {
                isOpen=false; win.classList.remove('active'); const r=lastRect;
                const sx=r.width/window.innerWidth, sy=r.height/window.innerHeight, tx=(r.left+r.width/2)-(window.innerWidth/2), ty=(r.top+r.height/2)-(window.innerHeight/2);
                win.style.transform=`translate(${tx}px,${ty}px) scale(${sx},${sy})`; win.style.borderRadius='18px';
                setTimeout(()=>{ win.style.opacity='0'; document.getElementById('web').src=''; },300);
            }
        });
        const lk=document.getElementById('lock'); let ly=0; lk.addEventListener('touchstart',e=>ly=e.touches[0].clientY); lk.addEventListener('touchmove',e=>{if(ly-e.touches[0].clientY>100)lk.classList.add('open');});
    </script>
</body>
</html>

